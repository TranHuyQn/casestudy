<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>game ban bong</title>
</head>
<body>
<img id="imgPlane" src="images/plane.png" style="display: none">
<img id="imgBg" src="images/background.png" style="display: none">
<canvas id="gameBoard" width="800" height="500" style="border: 1px solid #000000"></canvas>

<script src="plane.js"></script>
<script src="circles.js"></script>
<script>
    document.addEventListener('keyup', function (event) {
        if (event.keyCode == 37) {
            plane.isMoveLeft = false;
        } else if (event.keyCode == 39) {
            plane.isMoveRight = false;
        } else if (event.keyCode == 66) {
            plane.isShoot = false;
        }
    });

    document.addEventListener('keydown', function (event) {
        if (event.keyCode == 37) {
            plane.isMoveLeft = true;
        } else if (event.keyCode == 39) {
            plane.isMoveRight = true;
        } else if (event.keyCode == 66) {
            plane.isShoot = true;
        }
    });

    function crash(obj1, obj2) {
        let left1 = obj1.xPosition - obj1.radius;
        let right1 = obj1.xPosition + obj1.radius;
        let top1 = obj1.yPosition - obj1.radius;
        let bottom1 = obj1.yPosition + obj1.radius;
        let left2 = obj2.xPosition - obj2.radius;
        let right2 = obj2.xPosition + obj2.radius;
        let top2 = obj2.yPosition - obj2.radius;
        let bottom2 = obj2.yPosition + obj2.radius;
        if (right1 < left2 || bottom1 < top2 || left1 > right2 || top1 > bottom2) {
            return false;
        } else {
            return true;
        }
    }

    function checkCrash() {
        for (let circle = 0; circle < circles.length; circle++) {
            for (let bullet = 0; bullet < plane.bullets.length; bullet++) {
                if (crash(circles[circle], plane.bullets[bullet])) {
                    circles[circle].isLive = false;
                }
                plane.bullets.slice(bullet, 1);
            }
        }
    }

    let isGameOver = false;

    function processing() {
        if (!isGameOver) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            background.draw();
            showCircles();
            plane.draw();
            plane.move();
            plane.shoot();
            checkCrash();
            for (i = 0; i < circles.length; i++) {
                if (circles[i].yPosition > canvas.height) {
                    isGameOver = true;
                }
            }
            requestAnimationFrame(processing);
        } else {
            alert('Thua');
        }

    }

    processing();
</script>
</body>
</html>